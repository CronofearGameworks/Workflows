# Introduction
This is a high level description of how to make plugins in Unreal Engine 4.
If you don't know how to make plugins and you want to use this document as a guidance, i recommend you to watch these series of tutorials first: https://www.youtube.com/watch?v=jvkFrETmCoA&list=PL7Se41ZzAKZmvCeW9iBpEuh_hxD7bMqMF

This document describes a good workflow for developing plugins in UE4, supports hotreload and plugin content (Assets).

# What's this about

This is a workflow description about making a plugin in Unreal Engine 4. Following this workflow, you'll be able to develop a plugin with HotReload support and Plugin Content support. For achieving that, this workflow describes how to develop a plugin as a game module first, then "convert it" into a plugin.

# Steps
## Step 1 - Creating the required files
- 1) Create a C++ project in Unreal Engine 4. Remove the autogenerated C++ files that you don't want to use.
- 2) Open the UE4 project and create a plugin.
- 3) This will generate a plugin in "Project/Plugins/NameOfPlugin/"
- 4) This plugin will have the next following folders and files (importants):
  - Content: In case it doesn't exist, you can create a Content Folder and open the .uplugin file and add the property '"CanContainContent": true,'
  - Resources: The icon of the plugin.
  - Source: Contains the modules of the plugin, keep in mind that a plugin can contain more than 1 module.
  - .uplugin file: This file is the configuration file of your plugin.
  
NOTE: if the plugin also has Binaries, Intermediate, etc (autogenerated) folders. Remove them because they could create conflicts later on.
## Step 2 - Moving the plugin to the game modules (HOT RELOAD SUPPORT)
- 1) Copy the .uplugin file, save it somewhere because we're going to need it when we need to package the plugin.
- 2) Open the original .uplugin (the one that is in "Project/Plugins/NameOfPlugin/") and remove the modules description. The file should look like this without the modules:
```
{
	"FileVersion": 3,
	"Version": 1,
	"VersionName": "4.19",
	"FriendlyName": "Auto Save And Load System with Compression",
	"Description": "Auto save and load system just by adding a component to any Actor",
	"Category": "Cronofear Softworks",
	"CreatedBy": "Cronofear Softworks",
	"CreatedByURL": "http://cronofear.com/",
	"DocsURL": "https://cronofear.com/docs-save-load-system/welcome/",
	"MarketplaceURL": "com.epicgames.launcher://ue/marketplace/content/1908d4fc7b1a4c7faa285ed913155f2b",
	"SupportURL": "",
	"EngineVersion": "4.19.0",
	"CanContainContent": true,
	"Installed": true
}
```
- 3) Now we need to move the plugin's modules folders into the "Project/Source" folder, where the other game modules are. While developing our plugin as a game module, the plugin folder will only have the .uplugin file, a content folder and a resource folder. The good thing about this is that the plugin is an empty placeholder where we can still add content while we're developing our plugin.
- 4) Now, we need open the source folder of the plugin and we should see a folder with the name of the plugin's module. Cut this module, go to "Project/Source/" and paste the plugin's module here.
- 5) Now the "Project/Source/" folder should have two modules/folders. The "ProjectName" module, and the "PluginName" module.
- 6) In "Project/Source/" open the "ProjectName.Target.cs" and "ProjectNameEditor.Target.cs" files and change the following in both files:
```
ExtraModuleNames.AddRange( new string[] { "ProjectName" } );
```
to
```
ExtraModuleNames.AddRange( new string[] { "ProjectName", "PluginName"} );
```
where "ProjectName" and "PluginName" are the names of your modules/folders inside "Project/Source/".
- 7) Open the pluginmodule "Project/Source/PluginName/", and move the "PluginName.cpp" and "PluginName.h" that should be inside the "Public" and "Private" folders into "Project/Source/PluginName/".
- 8) Open the "PluginName.cpp" file and change the following:
```cpp
#undef LOCTEXT_NAMESPACE
IMPLEMENT_MODULE(FPluginNameModule, PluginName)
```
to
```cpp
#undef LOCTEXT_NAMESPACE
///PLUGIN
//IMPLEMENT_MODULE(FPluginNameModule, PluginName)
///MODULE
IMPLEMENT_PRIMARY_GAME_MODULE(FDefaultGameModuleImpl, PluginName, "PluginName");
```
Note that we're adding a IMPLEMENT_PRIMARY_GAME_MODULE line that will add hotreload support to this module.
We're commenting IMPLEMENT_MODULE because we'll need to uncomment it (and comment IMPLEMENT_PRIMARY_GAME_MODULE) when we'll need to package the plugin.
- 9) Finally, go to "Project/" and open the .uproject file with a text editor. Since we created the plugin in the begining, we should see something like this:
```
{
	"FileVersion": 3,
	"EngineAssociation": "4.19",
	"Category": "",
	"Description": "",
	"Modules": [
		{
			"Name": "ProjectName",
			"Type": "Runtime",
			"LoadingPhase": "Default"
		}
	],
	"Plugins": [
		{
			"Name": "PluginName",
			"Enabled": true,
			"MarketplaceURL": ""
		}
	]
}
```
This project file is supporting the plugin, so we can add content. However, we need to add the module too. Both the module and the plugin will have the exact same name. So we change the .uproject file into something like this:
```
{
	"FileVersion": 3,
	"EngineAssociation": "4.19",
	"Category": "",
	"Description": "",
	"Modules": [
		{
			"Name": "ProjectName",
			"Type": "Runtime",
			"LoadingPhase": "Default"
		},
    {
      "Name": "PluginName",
			"Type": "Runtime",
			"LoadingPhase": "Default"
    }
	],
	"Plugins": [
		{
			"Name": "PluginName",
			"Enabled": true,
			"MarketplaceURL": ""
		}
	]
}
```
Now our project is ready for plugin development. You can generate VS project files and start working on the plugin as if it were a game module that will support hot reload. Also, as we still have an empty plugin, we can still add content to the plugin.
## Step 3 - Packaging the plugin
- If you have added functionality to your plugin module (and/or content) and want to package it as a plugin, first undo the step 2.9)
- Then undo the step 2.8) (or comment the code)
- Undo the step 2.6)
- Move the plugin module from "Project/Source" to "Project/Plugins/PluginName/Source/"
- Copy the .uplugin file you saved in Step 2.1) and replace it in "Project/Plugins/PluginName/.uplugin".
- Go to "Project/" generate VS project files, compile the code, open the Project.
- If everything went right, in the UE4 editor, go to Plugins, the Plugin in development and click on "Package"
- Done!

# Final considerations
- The process of converting a plugin into a game module and viceversa could be automatized by some script (batch, python, etc). 
